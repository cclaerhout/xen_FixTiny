(function(){tinymce.create("tinymce.plugins.WordCount",{block:0,id:null,countre:null,cleanre:null,init:function(n){function o(n){return n!==u&&(n===r.ENTER||u===r.SPACEBAR||f(u))}function f(n){return n===r.DELETE||n===r.BACKSPACE}var i=this,u=0,r=tinymce.VK,e=n.getParam("wordcount_mode");e=="char"?(i.countre=/\S/g,i.cleanre=""):e=="charwp"?(i.countre=/(\S|\b[\u0020]\b)/g,i.cleanre=/\n/g):(i.countre=n.getParam("wordcount_countregex",/[\w\u2019\'-]+/g),i.cleanre=n.getParam("wordcount_cleanregex",/[0-9.(),;:!?%#$?\'\"_+=\\\/-]*/g)),i.update_rate=n.getParam("wordcount_update_rate",2e3),i.update_on_delete=n.getParam("wordcount_update_on_delete",!1),i.id=n.id+"-word-count",n.onPostRender.add(function(n){var e='">0</span>',f='<span id="',u,r,o="",s=n.getParam("wordcount_align");s=="right"&&(o="float: right"),r=n.getParam("wordcount_target_id"),r?tinymce.DOM.add(r,"span",{},f+i.id+e):(u=tinymce.DOM.get(n.id+"_path_row"),u&&tinymce.DOM.add(u.parentNode,"div",{style:o},n.getLang("xenforo.wordcount_phrase")+f+i.id+e))}),n.onInit.add(function(n){n.selection.onSetContent.add(function(){i._count(n)}),i._count(n)}),n.onSetContent.add(function(n){i._count(n)}),n.onKeyUp.add(function(n,t){(o(t.keyCode)||i.update_on_delete&&f(t.keyCode))&&i._count(n),u=t.keyCode})},_getCount:function(n){var r=0,t=n.getContent({format:"raw"}),i;return t&&(t=t.replace(/\.\.\./g," "),t=t.replace(/<.[^<>]*?>/g," ").replace(/&nbsp;|&#160;/gi," "),t=t.replace(/(\w+)(&.+?;)+(\w+)/,"$1$3").replace(/&.+?;/g," "),t=t.replace(this.cleanre,""),i=t.match(this.countre),i&&(r=i.length)),r},_count:function(n){var t=this;t.block||(t.block=1,setTimeout(function(){if(!n.destroyed){var i=t._getCount(n);tinymce.DOM.setHTML(t.id,i.toString()),setTimeout(function(){t.block=0},t.update_rate)}},1))},getInfo:function(){return{longname:"Word Count plugin",author:"Moxiecode Systems AB",authorurl:"http://tinymce.moxiecode.com",infourl:"http://wiki.moxiecode.com/index.php/TinyMCE:Plugins/wordcount",version:tinymce.majorVersion+"."+tinymce.minorVersion}}}),tinymce.PluginManager.add("wordcount",tinymce.plugins.WordCount)})();