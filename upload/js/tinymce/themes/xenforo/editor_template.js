(function(a){XenForo.tinymce={_overlay_callbacks:function(f,c,d){XenForo.tinymce.t=f;XenForo.tinymce.ontrigger=c;XenForo.tinymce.onload=d;var b=f.editor;if(typeof b=="undefined"){b=tinyMCE.activeEditor}XenForo.tinymce.ed=b;XenForo.tinymce.sel=b.selection;XenForo.tinymce.bm=b.selection.getBookmark()},_overlay_success:function(b){var d=XenForo.tinymce.t,c=XenForo.tinymce.ed;if(XenForo.hasResponseError(b)||typeof(b.templateHtml)=="undefined"){return}if(b.templateHtml){new XenForo.ExtLoader(b,function(){var g,h,f=XenForo.isTouchBrowser();if(f){h="10%"}else{h="center"}g=a(b.templateHtml).xfInsert("prependTo","body","xfFadeIn").overlay({mask:{color:"#000000",zIndex:200010,loadSpeed:200,opacity:0.6},onBeforeLoad:function(i){a(".xenOverlay").css("opacity","0.5")},onLoad:function(i){$myOverlay=this.getOverlay().insertAfter("#exposeMask").addClass("isLoaded");$trigger=$myOverlay.find(".tinyTrigger");$focus=$myOverlay.find(".mceFocus");$inputs=$myOverlay.find("input,textarea,select");if(typeof XenForo.tinymce.onload!="undefined"){d[XenForo.tinymce.onload](XenForo.tinymce.sel,$myOverlay)}$inputs.not("textarea").bind("keypress",function(j){if(j.which==13){j.preventDefault();$trigger.trigger("click")}});$trigger.one("click",function(k){k.stopImmediatePropagation();var j={};$inputs.each(function(l){j[a(this).attr("name")]=a(this).val()});g.close();c.selection.moveToBookmark(XenForo.tinymce.bm);if(typeof XenForo.tinymce.ontrigger!="undefined"){d[XenForo.tinymce.ontrigger](j)}return false});$focus.focus()},onClose:function(i){this.getOverlay().remove();a(".xenOverlay").css("opacity","1").expose();a(".mceIframeContainer iframe").contents().find('*[data-mce-type="bookmark"]').contents().unwrap()},top:h,left:0,fixed:!f,closeOnClick:false,oneInstance:false,load:true,api:true}).load();return false})}},_unescapeHtml:function(d,c){d=d.replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&#039;/g,"'");if(c=="space"){d=d.replace(/	/g,"\t").replace(/&nbsp;/g,"  ").replace(/<\/p>\n<p>/g,"\n")}var b=new RegExp("^<p>([\\s\\S]+)</p>$","i");if(b.test(d)){d=d.match(b);d=d[1]}return d},_escapeHtml:function(c,b){if(b!="onlyspace"){c=c.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}if(b=="space"||b=="onlyspace"){c=c.replace(/\t/g,"	").replace(/ /g,"&nbsp;").replace(/\n/g,"</p>\n<p>")}return c},_zen2han:function(g){var b,d="",c,f;for(c=0,f=g.length;c<f;c++){b=g.charCodeAt(c);b=((b>=65281&&b<=65392)?b-65248:b);b=(b===12540?45:b);d=d+String.fromCharCode(b)}return d}}})(jQuery);(function(){var a=function(f,b){var d=f.selection,g,c,h;g="["+b+"]"+d.getContent().replace(/^<p>/,"").replace(/<\/p>$/,"")+'<span id="__xfBbCaret">_</span>[/'+b+"]";g="<p>"+g+"</p>";d.setContent(g);if(f.getDoc().createRange){h=f.dom.get("__xfBbCaret");c=f.getDoc().createRange();c.setStartBefore(h);c.setEndBefore(h);d.setRng(c)}f.dom.remove("__xfBbCaret")};tinymce.create("tinymce.plugins.XenForoCustomBbCode",{init:function(b,c){b.addCommand("xenForoWrapBbCode",function(d,f){a(b,f)})},addButtons:function(f,c){var d=f.settings.xenforo_custom_bbcode_tags,b=f.editor.controlManager;c.add(b.createButton("xenforo_quote",{title:"xenforo.quote",cmd:"xenForoWrapBbCode",ui:false,value:"QUOTE"}));if(typeof d==="undefined"||d.length===0||d==={}){return}tinymce.each(d,function(g,h){c.add(b.createButton("xenforo_custom_bbcode_"+h,{title:g[0],image:g[1],cmd:"xenForoWrapBbCode",ui:false,value:h}))})},getInfo:function(){return{longname:"XenForo Custom BB Code",author:"",version:"1.0"}}});tinymce.create("tinymce.plugins.XenForoSmilies",{addButtons:function(i,c){var f=i.settings.xenforo_smilies,b=i.editor.controlManager,g=i.editor,d,h=tinymce.DOM;if(typeof f==="undefined"||f.length===0||f==={}){return}d=b.createColorSplitButton("xenforo_smilies",{title:"xenforo.smilies_desc",icons:false,onclick:function(){d.showMenu()},onselect:function(k,j){var l;j=h.encode(j)+" ";if(typeof k=="number"){l='<img src="styles/default/xenforo/clear.png" alt="'+j+'" class="mceSmilieSprite mceSmilie'+k+'" data-smilie="yes" /> '}else{l='<img src="'+h.encode(k)+'" alt="'+j+'" class="mceSmilie" data-smilie="yes" /> '}g.execCommand("mceInsertContent",false,l)},smilies:f},tinymce.ui.XenForoSmiliesButton);c.add(d)},getInfo:function(){return{longname:"XenForo Smilies",author:"",version:"2.0"}}});tinymce.create("tinymce.plugins.XenForoMedia",{addButtons:function(h,c){var b=h.editor.controlManager,d=h.editor,f,g=tinymce.DOM,i=this;f=b.createButton("xenforo_media",{title:"xenforo.media_desc",onclick:function(j,k){if(d.getParam("fast_overlay")==1){XenForo.tinymce._overlay_callbacks(i,"_media_ontrigger","_media_onload");XenForo.ajax("index.php?editor/fast-dialog",{dialog:"fast_media"},XenForo.tinymce._overlay_success)}else{d.windowManager.open({url:h._getFullDialogUrl("media"),width:310,height:300,inline:true})}}});c.add(f)},_media_ontrigger:function(b){XenForo.ajax("index.php?editor/media",{url:b.url},this._media_insert)},_media_insert:function(b){if(XenForo.hasResponseError(b)){return false}var c=XenForo.tinymce.ed;if(b.matchBbCode){c.execCommand("mceInsertContent",false,b.matchBbCode)}else{if(b.noMatch){alert(b.noMatch)}}},_media_onload:function(d,b){var c=d.getContent();c=XenForo.tinymce._unescapeHtml(c,"space");if(c.length>0){b.find("#ctrl_url").val(c)}},getInfo:function(){return{longname:"XenForo Media",author:"",version:"1.0"}}});tinymce.create("tinymce.plugins.XenForoCode",{addButtons:function(h,c){var b=h.editor.controlManager,d=h.editor,f,g=tinymce.DOM,i=this;f=b.createButton("xenforo_code",{title:"xenforo.code",onclick:function(j,k){if(d.getParam("fast_overlay")==1){XenForo.tinymce._overlay_callbacks(i,"_code_ontrigger","_code_onload");XenForo.ajax("index.php?editor/fast-dialog",{dialog:"fast_code"},XenForo.tinymce._overlay_success)}else{d.windowManager.open({url:h._getFullDialogUrl("code"),width:400,height:300,inline:true})}}});c.add(f)},_code_ontrigger:function(c){var f=XenForo.tinymce.ed,b,g,d;switch(c.type){case"html":b="HTML";break;case"php":b="PHP";break;default:b="CODE"}g=XenForo.tinymce._escapeHtml(c.code,"space");d="["+b+"]"+g+"[/"+b+"]";if(d.match(/\n/)){d="<p>"+d+"</p>"}f.execCommand("mceInsertContent",false,d)},_code_onload:function(c,b){},getInfo:function(){return{longname:"XenForo Code",author:"",version:"1.0"}}});tinymce.create("tinymce.plugins.XenForoElastic",{init:function(b){if($.browser.msie&&$.browser.version<=6){return}var d,f,i=0,h,g,c;g=function(){h=$(b.getContentAreaContainer()).find("iframe");f=parseInt(h.css("height"));d=$(window).height()-200;if(h.closest(".xenOverlay").length){d-=(d+200)/10}d=Math.max(d,f);$(b.getBody()).css("overflow-y","hidden");c();setTimeout(c,250)};c=function(){if(!h){return}var j=b.getDoc().documentElement.scrollHeight,l,m,k=($.browser.webkit||($.browser.msie&&$.browser.version>=9));if(!k){j+=22}if(j<f){j=f}else{if(j>d){j=d}}if(j!=i){if(!$.browser.msie||$.browser.version>=9){if(i<j&&j==d){$(b.getBody()).css("overflow-y","auto")}else{if(i==d&&j<d){$(b.getBody()).css("overflow-y","hidden")}}}h.height(j);i=j}};b.onInit.add(g);b.onSetContent.add(c);b.onPaste.add(c);b.onChange.add(c);b.onKeyDown.add(c);b.addCommand("xenForoElastic",function(j,k){c()})},getInfo:function(){return{longname:"XenForo Elastic",author:"",version:"1.0"}}});tinymce.create("tinymce.plugins.XenForoBbCodeSwitch",{init:function(b){var c=this;c.editor=b;b.onPostRender.add(function(){$("<a />").attr("class","mceButton mceButtonEnabled bbCodeEditorButton").append($("<span />").attr({title:b.settings.xenforo_bbcode_switch_text[0],"class":"mceIcon"}).click($.context(c,"wysiwygToBbCode"))).prependTo("#"+b.id+"_tbl td.mceToolbar")})},wysiwygToBbCode:function(){XenForo.ajax("index.php?editor/to-bb-code",{html:this.editor.getContent()},$.context(this,"wysiwygToBbCodeSuccess"))},wysiwygToBbCodeSuccess:function(b){if(XenForo.hasResponseError(b)||typeof(b.bbCode)=="undefined"){return}var c=this.editor;$container=$(c.getContainer()),$existingTextArea=$(c.getElement()),$textContainer=$('<div class="bbCodeEditorContainer" />'),$newTextArea=$('<textarea class="textCtrl Elastic" rows="5" />');if($existingTextArea.attr("disabled")){return}$newTextArea.attr("name",$existingTextArea.attr("name").replace(/_html(]|$)/,"")).val(b.bbCode).appendTo($textContainer);$("<a />").attr("href","javascript:").text(c.settings.xenforo_bbcode_switch_text[1]).click($.context(this,"bbCodeToWysiwyg")).appendTo($("<div />").appendTo($textContainer));$existingTextArea.attr("disabled",true).after($textContainer);if($.browser.mozilla){$(window).unbind("unload.rte").bind("unload.rte",function(){$existingTextArea.removeAttr("disabled")})}$container.hide();$textContainer.xfActivate();$newTextArea.focus();this.$bbCodeTextContainer=$textContainer;this.$bbCodeTextArea=$newTextArea},bbCodeToWysiwyg:function(){XenForo.ajax("index.php?editor/to-html",{bbCode:this.$bbCodeTextArea.val()},$.context(this,"bbCodeToWysiwygSuccess"))},bbCodeToWysiwygSuccess:function(b){if(XenForo.hasResponseError(b)||typeof(b.html)=="undefined"){return}var c=this.editor;$container=$(c.getContainer()),$existingTextArea=$(c.getElement());if(!$existingTextArea.attr("disabled")){return}$existingTextArea.attr("disabled",false);$container.show();c.setContent(b.html);c.focus();this.$bbCodeTextContainer.remove()},getInfo:function(){return{longname:"XenForo BB Code Switch",author:"",version:"1.0"}}});tinymce.PluginManager.add("xenforo_custom_bbcode",tinymce.plugins.XenForoCustomBbCode);tinymce.PluginManager.add("xenforo_smilies",tinymce.plugins.XenForoSmilies);tinymce.PluginManager.add("xenforo_media",tinymce.plugins.XenForoMedia);tinymce.PluginManager.add("xenforo_code",tinymce.plugins.XenForoCode);tinymce.PluginManager.add("xenforo_elastic",tinymce.plugins.XenForoElastic);tinymce.PluginManager.add("xenforo_bbcode_switch",tinymce.plugins.XenForoBbCodeSwitch)})();(function(d){var c=d.DOM,a=d.dom.Event,b=d.is,f=d.each;d.create("tinymce.ui.XenForoSmiliesButton:tinymce.ui.SplitButton",{XenForoSmiliesButton:function(i,h){var g=this;g.parent(i,h);g.settings=h=d.extend({smilies:{}},g.settings);g.onShowMenu=new d.util.Dispatcher(g);g.onHideMenu=new d.util.Dispatcher(g)},showMenu:function(){var g=this,h,k,j,i;if(g.isDisabled()){return}if(!g.isMenuRendered){g.renderMenu();g.isMenuRendered=true}if(g.isMenuVisible){return g.hideMenu()}j=c.get(g.id);c.show(g.id+"_menu");c.addClass(j,"mceSplitButtonSelected");i=c.getPos(j);c.setStyles(g.id+"_menu",{left:i.x,top:i.y+j.clientHeight,zIndex:200000});j=0;a.add(c.doc,"mousedown",g.hideMenu,g);if(g._focused){g._keyHandler=a.add(g.id+"_menu","keydown",function(l){if(l.keyCode==27){g.hideMenu()}});c.select("a",g.id+"_menu")[0].focus()}g.isMenuVisible=1},hideMenu:function(h){var g=this;if(h&&h.type=="mousedown"&&c.getParent(h.target,function(i){return i.id===g.id+"_open"})){return}if(!h||!c.getParent(h.target,".mceSplitButtonMenu")){c.removeClass(g.id,"mceSplitButtonSelected");a.remove(c.doc,"mousedown",g.hideMenu,g);a.remove(g.id+"_menu","keydown",g._keyHandler);c.hide(g.id+"_menu")}g.isMenuVisible=0},renderMenu:function(){var l=this,g,k=0,o=l.settings,q,j,p,h;h=c.add(o.menu_container,"div",{id:l.id+"_menu","class":o.menu_class+" "+o["class"],style:"position:absolute;left:0;top:-1000px;"});g=c.add(h,"div",{"class":o["class"]+" mceSplitButtonMenu mceSmiliesMenu"});c.add(g,"span",{"class":"mceMenuLine"});q=c.add(g,"div");k=0;f(o.smilies,function(i,n){var r,m;if(typeof i[1]=="number"){r='<img src="styles/default/xenforo/clear.png" alt="" title="'+c.encode(i[0]+"	"+n)+'" class="mceSmilieSprite mceSmilie'+i[1]+'" />'}else{r='<img src="'+c.encode(i[1])+'" alt="" title="'+c.encode(i[0]+"	"+n)+'" />'}c.add(q,"a",{href:"javascript:;","data-smilieInfo":i[1],"data-smilieText":n},r)});a.add(l.id+"_menu","click",function(i){var n,m;i=i.target;m=$(i).closest("[data-smilieInfo]");if(m.length){l.settings.onselect(m.data("smilieInfo"),m.data("smilieText"));l.hideMenu()}return a.cancel(i)});return h},destroy:function(){this.parent();a.clear(this.id+"_menu");c.remove(this.id+"_menu")}})})(tinymce);(function(){var d=tinymce.DOM,b=tinymce.dom.Element,a=tinymce.dom.Event,f=tinymce.each,c=tinymce.is;tinymce.create("tinymce.plugins.XenForoInlinePopups",{init:function(g,h){g.onBeforeRenderUI.add(function(){g.windowManager=new tinymce.XenForoInlineWindowManager(g)})},getInfo:function(){return{longname:"XenForoInlinePopups",author:"Moxiecode Systems AB, modifications for XenForo",version:"1.0"}}});tinymce.create("tinymce.XenForoInlineWindowManager:tinymce.WindowManager",{XenForoInlineWindowManager:function(g){var h=this;h.parent(g);h.zIndex=300000;h.count=0;h.windows={}},open:function(r,j){var y=this,i,k="",q=y.editor,g=0,s=0,h,m,n,o,l,v,x;r=r||{};j=j||{};if(!r.inline){return y.parent(r,j)}if(!r.type){y.bookmark=q.selection.getBookmark(1)}i=d.uniqueId();h=d.getViewPort();r.width=parseInt(r.width||320);r.height=parseInt(r.height||240)+(tinymce.isIE?8:0);r.min_width=parseInt(r.min_width||150);r.min_height=parseInt(r.min_height||100);r.max_width=parseInt(r.max_width||2000);r.max_height=parseInt(r.max_height||2000);r.left=r.left||Math.round(Math.max(h.x,h.x+(h.w/2)-(r.width/2)));r.top=r.top||Math.round(Math.max(h.y,h.y+(h.h/2)-(r.height/2)));r.movable=r.resizable=true;j.mce_width=r.width;j.mce_height=r.height;j.mce_inline=true;j.mce_window_id=i;j.mce_auto_focus=r.auto_focus;y.features=r;y.params=j;y.onOpen.dispatch(y,r,j);if(r.type){k+=" mceModal";if(r.type){k+=" mce"+r.type.substring(0,1).toUpperCase()+r.type.substring(1)}r.resizable=false}y._addAll(d.doc.body,["div",{id:i,"class":"editorInlinePopup",style:"width:100px; height:100px"},["div",{id:i+"_content","class":"popupContent",style:"height:100%"}]]);d.setStyles(i,{top:-10000,left:-10000});d.setStyles(i,{top:r.top,left:r.left,width:r.width+g});x=r.url||r.file;if(x){if(tinymce.relaxedDomain){x+=(x.indexOf("?")==-1?"?":"&")+"mce_rdomain="+tinymce.relaxedDomain}x=tinymce._addVer(x)}if(!r.type){d.add(i+"_content","iframe",{id:i+"_ifr",src:"javascript:;",frameBorder:0,scrolling:"no",style:"border:0; width:100%; height: 100%;"});a.add(i+"_ifr","load",function(p){d.setStyles(i,{height:p.target.contentWindow.document.documentElement.scrollHeight});d.setStyles(i+"_ifr",{height:p.target.contentWindow.document.documentElement.scrollHeight})});d.setAttrib(i+"_ifr","src",x);d.get(i+"_ifr").focus()}else{d.add(i+"_wrapper","a",{id:i+"_ok","class":"mceButton mceOk",href:"javascript:;",onmousedown:"return false;"},"Ok");if(r.type=="confirm"){d.add(i+"_wrapper","a",{"class":"mceButton mceCancel",href:"javascript:;",onmousedown:"return false;"},"Cancel")}d.add(i+"_middle","div",{"class":"mceIcon"});d.setHTML(i+"_content",r.content.replace("\n","<br />"))}v=y.windows[i]={id:i,mousedown_func:n,click_func:o,element:new b(i,{blocker:1,container:q.getContainer()}),iframeElement:new b(i+"_ifr"),features:r,deltaWidth:g,deltaHeight:s};v.iframeElement.on("focus",function(){y.focus(i)});if(y.count==0&&y.editor.getParam("dialog_type","modal")=="modal"){d.add(d.doc.body,"div",{id:"mceModalBlocker","class":"editorInlinePopup_modalBlocker",style:{zIndex:y.zIndex-1}});a.add("mceModalBlocker","click",function(){y.close(null,i)});d.show("mceModalBlocker")}else{d.setStyle("mceModalBlocker","z-index",y.zIndex-1)}if(tinymce.isIE6||/Firefox\/2\./.test(navigator.userAgent)||(tinymce.isIE&&!d.boxModel)){d.setStyles("mceModalBlocker",{position:"absolute",left:h.x,top:h.y,width:h.w-2,height:h.h-2})}y.focus(i);y._fixIELayout(i,1);if(d.get(i+"_ok")){d.get(i+"_ok").focus()}y.count++;return v},focus:function(i){var h=this,g;if(g=h.windows[i]){g.zIndex=this.zIndex++;g.element.setStyle("zIndex",g.zIndex);g.element.update();i=i+"_wrapper";d.removeClass(h.lastId,"mceFocus");d.addClass(i,"mceFocus");h.lastId=i}},_addAll:function(l,j){var h,m,g=this,k=tinymce.DOM;if(c(j,"string")){l.appendChild(k.doc.createTextNode(j))}else{if(j.length){l=l.appendChild(k.create(j[0],j[1]));for(h=2;h<j.length;h++){g._addAll(l,j[h])}}}},resizeBy:function(h,i,j){return;var g=this.windows[j];if(g){g.element.resizeBy(h,i);g.iframeElement.resizeBy(h,i)}},close:function(k,m){var i=this,h,l=d.doc,g=0,j,m;m=i._findId(m||k);if(!i.windows[m]){i.parent(k);return}i.count--;if(i.count==0){d.remove("mceModalBlocker")}if(h=i.windows[m]){i.onClose.dispatch(i);a.remove(l,"mousedown",h.mousedownFunc);a.remove(l,"click",h.clickFunc);a.clear(m);a.clear(m+"_ifr");d.setAttrib(m+"_ifr","src",'javascript:""');h.element.remove();delete i.windows[m];f(i.windows,function(n){if(n.zIndex>g){j=n;g=n.zIndex}});if(j){i.focus(j.id)}}},setTitle:function(g,h){var i;g=this._findId(g);if(i=d.get(g+"_title")){i.innerHTML=d.encode(h)}},alert:function(h,g,k){var j=this,i;i=j.open({title:j,type:"alert",button_func:function(l){if(g){g.call(l||j,l)}j.close(null,i.id)},content:d.encode(j.editor.getLang(h,h)),inline:1,width:400,height:130})},confirm:function(h,g,k){var j=this,i;i=j.open({title:j,type:"confirm",button_func:function(l){if(g){g.call(l||j,l)}j.close(null,i.id)},content:d.encode(j.editor.getLang(h,h)),inline:1,width:400,height:130})},_findId:function(g){var h=this;if(typeof(g)=="string"){return g}f(h.windows,function(i){var j=d.get(i.id+"_ifr");if(j&&g==j.contentWindow){g=i.id;return false}});return g},_fixIELayout:function(j,i){var g,h;if(!tinymce.isIE6){return}if(g=this.windows[j]){g.element.hide();g.element.show();f(d.select("div,a",j),function(l,k){if(l.currentStyle.backgroundImage!="none"){h=new Image();h.src=l.currentStyle.backgroundImage.replace(/url\(\"(.+)\"\)/,"$1")}});d.get(j).style.filter=""}}});tinymce.PluginManager.add("xenforo_inline_popups",tinymce.plugins.XenForoInlinePopups)})();(function(f){var d=f.DOM,b=f.dom.Event,i=f.extend,g=f.each,a=f.util.Cookie,h,c=f.explode;f.create("tinymce.themes.XenForoTheme",{sizes:[8,10,12,14,18,24,36],controls:{bold:["bold_desc","Bold"],italic:["italic_desc","Italic"],underline:["underline_desc","Underline"],strikethrough:["strikethrough_desc","Strikethrough"],justifyleft:["justifyleft_desc","JustifyLeft"],justifycenter:["justifycenter_desc","JustifyCenter"],justifyright:["justifyright_desc","JustifyRight"],justifyfull:["justifyfull_desc","JustifyFull"],bullist:["bullist_desc","InsertUnorderedList"],numlist:["numlist_desc","InsertOrderedList"],outdent:["outdent_desc","Outdent"],indent:["indent_desc","Indent"],cut:["cut_desc","Cut"],copy:["copy_desc","Copy"],paste:["paste_desc","Paste"],undo:["undo_desc","Undo"],redo:["redo_desc","Redo"],link:["link_desc","mceLink"],unlink:["unlink_desc","unlink"],image:["image_desc","mceImage"],cleanup:["cleanup_desc","mceCleanup"],help:["help_desc","mceHelp"],code:["code_desc","mceCodeEditor"],hr:["hr_desc","InsertHorizontalRule"],removeformat:["removeformat_desc","RemoveFormat"],sub:["sub_desc","subscript"],sup:["sup_desc","superscript"],forecolor:["forecolor_desc","ForeColor"],forecolorpicker:["forecolor_desc","mceForeColor"],backcolor:["backcolor_desc","HiliteColor"],backcolorpicker:["backcolor_desc","mceBackColor"],charmap:["charmap_desc","mceCharMap"],visualaid:["visualaid_desc","mceToggleVisualAid"],anchor:["anchor_desc","mceInsertAnchor"],blockquote:["blockquote_desc","mceBlockQuote"]},stateControls:["bold","italic","underline","strikethrough","bullist","numlist","justifyleft","justifycenter","justifyright","justifyfull","sub","sup","blockquote"],init:function(m,j){var u=this,w,r,k;u.editor=m;u.url=j;u.onResolveName=new f.util.Dispatcher(this);if(!m.settings.skin||m.settings.skin=="default"){m.settings.skin="xenForo"}m.settings.popup_css=false;m.settings.language="xenforo";m.settings.paste_remove_styles_if_webkit=false;m.settings.convert_urls=false;m.settings.gecko_spellcheck=true;m.settings.entities="160,nbsp,38,amp,34,quot,60,lt,62,gt";m.onPostProcess.add(function(s,t){t.content=t.content.replace(/\t/g,"&nbsp;&nbsp;&nbsp; ")});var n=XenForo.isRTL(),q=(n?"justifyright,justifycenter,justifyleft":"justifyleft,justifycenter,justifyright"),l=(n?"redo,undo":"undo,redo"),p=(n?"indent,outdent":"outdent,indent");u.settings=w=i({theme_xenforo_path:true,theme_xenforo_buttons1:"removeformat,|,fontselect,fontsizeselect,forecolor,xenforo_smilies,|,"+l,theme_xenforo_buttons2:"bold,italic,underline,strikethrough,|,"+q+",|,bullist,numlist,"+p+",|,link,unlink,image,xenforo_media,|,xenforo_code,xenforo_custom_bbcode",theme_xenforo_buttons3:"",theme_xenforo_toolbar_location:"top",theme_xenforo_toolbar_align:"left",theme_xenforo_blockformats:"p,address,pre,h1,h2,h3,h4,h5,h6",theme_xenforo_fonts:"Andale Mono=andale mono,times;Arial=arial,helvetica,sans-serif;Arial Black=arial black,avant garde;Book Antiqua=book antiqua,palatino;Courier New=courier new,courier;Georgia=georgia,palatino;Helvetica=helvetica;Impact=impact,chicago;Tahoma=tahoma,arial,helvetica,sans-serif;Times New Roman=times new roman,times;Trebuchet MS=trebuchet ms,geneva;Verdana=verdana,geneva",theme_xenforo_more_colors:1,theme_xenforo_row_height:23,theme_xenforo_resize_horizontal:1,theme_xenforo_resizing_use_cookie:1,theme_xenforo_font_sizes:"1,2,3,4,5,6,7",theme_xenforo_font_selector:"span",theme_xenforo_dialog_url:"",readonly:m.settings.readonly},m.settings);m.settings.formats={xenForoRemoveFormat:[{selector:"h1,h2,h3,h4,h5,h6",remove:"all",split:true,expand:false,block_expand:true,deep:true}]};if(f.is(w.theme_xenforo_font_sizes,"string")){w.font_size_style_values=f.explode(w.font_size_style_values);w.font_size_classes=f.explode(w.font_size_classes||"");k={};m.settings.theme_xenforo_font_sizes=w.theme_xenforo_font_sizes;g(m.getParam("theme_xenforo_font_sizes","","hash"),function(t,s){var o;if(s==t&&t>=1&&t<=7){if(m.settings.convert_fonts_to_spans){o=w.font_size_classes[t-1];t=w.font_size_style_values[t-1]||(u.sizes[t-1]+"pt")}}if(/^\s*\./.test(t)){o=t.replace(/\./g,"")}k[s]=o?{"class":o}:{fontSize:t}});w.theme_xenforo_font_sizes=k}if((r=w.theme_xenforo_path_location)&&r!="none"){w.theme_xenforo_statusbar_location=w.theme_xenforo_path_location}if(w.theme_xenforo_statusbar_location=="none"){w.theme_xenforo_statusbar_location=0}m.onInit.add(function(){m.onNodeChange.add(u._nodeChanged,u);m.dom.loadCSS(w.theme_xenforo_contents_css_url);m.editorCommands.addCommands({Outdent:$.context(u,"_queryOutdent")},"state");var o="p,h1,h2,h3,h4,h5,h6,td,th,div,ul,ol,li";m.formatter.register({alignleft:[{selector:o,styles:{textAlign:"left"}},{selector:"img,table",collapsed:false,styles:{display:"block",marginLeft:"0",marginRight:"auto"}}],alignright:[{selector:o,styles:{textAlign:"right"}},{selector:"img,table",collapsed:false,styles:{display:"block",marginLeft:"auto",marginRight:"0"}}]})});m.addShortcut("shift+ctrl+z",m.getLang("redo_desc"),"Redo");m.onSetProgressState.add(function(t,o,v){var x,y=t.id,s;if(o){u.progressTimer=setTimeout(function(){x=t.getContainer();x=x.insertBefore(d.create("DIV",{style:"position:relative"}),x.firstChild);s=d.get(t.id+"_tbl");d.add(x,"div",{id:y+"_blocker","class":"mceBlocker",style:{width:s.clientWidth+2,height:s.clientHeight+2}});d.add(x,"div",{id:y+"_progress","class":"mceProgress",style:{left:s.clientWidth/2,top:s.clientHeight/2}})},v||0)}else{d.remove(y+"_blocker");d.remove(y+"_progress");clearTimeout(u.progressTimer)}})},createControl:function(m,j){var k,l;if(l=j.createControl(m)){return l}switch(m){case"styleselect":return this._createStyleSelect();case"formatselect":return this._createBlockFormats();case"fontselect":return this._createFontSelect();case"fontsizeselect":return this._createFontSizeSelect();case"forecolor":return this._createForeColorMenu();case"backcolor":return this._createBackColorMenu()}if((k=this.controls[m])){return j.createButton(m,{title:"xenforo."+k[0],cmd:k[1],ui:k[2],value:k[3]})}},execCommand:function(l,k,m){var j=this["_"+l];if(j){j.call(this,k,m);return true}return false},_importClasses:function(k){var j=this.editor,l=j.controlManager.get("styleselect");if(l.getLength()==0){g(j.dom.getClasses(),function(m){l.add(m["class"],m["class"])})}},_createStyleSelect:function(o){var k=this,j=k.editor,l=j.controlManager,m=l.createListBox("styleselect",{title:"xenforo.style_select",onselect:function(n){if(m.selectedValue===n){j.execCommand("mceSetStyleInfo",0,{command:"removeformat"});m.select();return false}else{j.execCommand("mceSetCSSClass",0,n)}}});if(m){g(j.getParam("theme_xenforo_styles","","hash"),function(p,n){if(p){m.add(k.editor.translate(n),p)}});m.onPostRender.add(function(p,q){if(!m.NativeListBox){b.add(q.id+"_text","focus",k._importClasses,k);b.add(q.id+"_text","mousedown",k._importClasses,k);b.add(q.id+"_open","focus",k._importClasses,k);b.add(q.id+"_open","mousedown",k._importClasses,k)}else{b.add(q.id,"focus",k._importClasses,k)}})}return m},_createFontSelect:function(){var l,k=this,j=k.editor;l=j.controlManager.createListBox("fontselect",{title:"xenforo.fontdefault",cmd:"FontName"});if(l){g(j.getParam("theme_xenforo_fonts",k.settings.theme_xenforo_fonts,"hash"),function(n,m){l.add(j.translate(m),n,{style:n.indexOf("dings")==-1?"font-family:"+n:""})})}return l},_createFontSizeSelect:function(){var m=this,k=m.editor,n,l=0,j=[];n=k.controlManager.createListBox("fontsizeselect",{title:"xenforo.font_size",onselect:function(o){if(o.fontSize){k.execCommand("FontSize",false,o.fontSize)}else{g(m.settings.theme_xenforo_font_sizes,function(q,p){if(q["class"]){j.push(q["class"])}});k.editorCommands._applyInlineStyle("span",{"class":o["class"]},{check_classes:j})}}});if(n){g(m.settings.theme_xenforo_font_sizes,function(p,o){var q=p.fontSize;if(q>=1&&q<=7){q=m.sizes[parseInt(q)-1]+"pt"}n.add(o,p,{style:"font-size:"+q,"class":"mceFontSize"+(l++)+(" "+(p["class"]||""))})})}return n},_createBlockFormats:function(){var l,j={p:"xenforo.paragraph",address:"xenforo.address",pre:"xenforo.pre",h1:"xenforo.h1",h2:"xenforo.h2",h3:"xenforo.h3",h4:"xenforo.h4",h5:"xenforo.h5",h6:"xenforo.h6",div:"xenforo.div",blockquote:"xenforo.blockquote",code:"xenforo.code",dt:"xenforo.dt",dd:"xenforo.dd",samp:"xenforo.samp"},k=this;l=k.editor.controlManager.createListBox("formatselect",{title:"xenforo.block",cmd:"FormatBlock"});if(l){g(k.editor.getParam("theme_xenforo_blockformats",k.settings.theme_xenforo_blockformats,"hash"),function(n,m){l.add(k.editor.translate(m!=n?m:j[n]),n,{"class":"mce_formatPreview mce_"+n})})}return l},_createForeColorMenu:function(){var n,k=this,l=k.settings,m={},j;if(l.theme_xenforo_more_colors){m.more_colors_func=function(){k._mceColorPicker(0,{color:n.value,func:function(o){n.setColor(o)}})}}if(j=l.theme_xenforo_text_colors){m.colors=j}if(l.theme_xenforo_default_foreground_color){m.default_color=l.theme_xenforo_default_foreground_color}m.title="xenforo.forecolor_desc";m.cmd="ForeColor";m.scope=this;n=k.editor.controlManager.createColorSplitButton("forecolor",m);return n},_createBackColorMenu:function(){var n,k=this,l=k.settings,m={},j;if(l.theme_xenforo_more_colors){m.more_colors_func=function(){k._mceColorPicker(0,{color:n.value,func:function(o){n.setColor(o)}})}}if(j=l.theme_xenforo_background_colors){m.colors=j}if(l.theme_xenforo_default_background_color){m.default_color=l.theme_xenforo_default_background_color}m.title="xenforo.backcolor_desc";m.cmd="HiliteColor";m.scope=this;n=k.editor.controlManager.createColorSplitButton("backcolor",m);return n},renderUI:function(l){var q,m,r,w=this,u=w.editor,x=w.settings,v,k,j;if(u.settings){u.settings.aria_label=x.aria_label+u.getLang("advanced.help_shortcut")}q=k=d.create("span",{role:"application","aria-labelledby":u.id+"_voice",id:u.id+"_parent","class":"mceEditor "+u.settings.skin+"Skin"+(x.skin_variant?" "+u.settings.skin+"Skin"+w._ufirst(x.skin_variant):"")});d.add(q,"span",{"class":"mceVoiceLabel",style:"display:none;",id:u.id+"_voice"},x.aria_label);if(!d.boxModel){q=d.add(q,"div",{"class":"mceOldBoxModel"})}q=v=d.add(q,"table",{role:"presentation",id:u.id+"_tbl","class":"mceLayout",cellSpacing:0,cellPadding:0});q=r=d.add(q,"tbody");switch((x.theme_xenforo_layout_manager||"").toLowerCase()){case"rowlayout":m=w._rowLayout(x,r,l);break;case"customlayout":m=u.execCallback("theme_xenforo_custom_layout",x,r,l,k);break;default:m=w._simpleLayout(x,r,l,k)}q=l.targetNode;j=v.rows;d.addClass(j[0],"mceFirst");d.addClass(j[j.length-1],"mceLast");g(d.select("tr",r),function(o){d.addClass(o.firstChild,"mceFirst");d.addClass(o.childNodes[o.childNodes.length-1],"mceLast")});if(d.get(x.theme_xenforo_toolbar_container)){d.get(x.theme_xenforo_toolbar_container).appendChild(k)}else{d.insertAfter(k,q)}b.add(u.id+"_path_row","click",function(n){n=n.target;if(n.nodeName=="A"){w._sel(n.className.replace(/^.*mcePath_([0-9]+).*$/,"$1"));return b.cancel(n)}});if(!u.getParam("accessibility_focus")){b.add(d.add(k,"a",{href:"#"},"<!-- IE -->"),"focus",function(){tinyMCE.get(u.id).focus()})}if(x.theme_xenforo_toolbar_location=="external"){l.deltaHeight=0}w.deltaHeight=l.deltaHeight;l.targetNode=null;u.onKeyDown.add(function(p,n){var s=121,o=122;if(n.altKey){if(n.keyCode===s){w.toolbarGroup.focus();return b.cancel(n)}else{if(n.keyCode===o){d.get(p.id+"_path_row").focus();return b.cancel(n)}}}});u.addShortcut("alt+0","","mceShortcuts",w);return{iframeContainer:m,editorContainer:u.id+"_parent",sizeContainer:v,deltaHeight:l.deltaHeight}},getInfo:function(){return{longname:"XenForo theme",author:"",authorurl:"",version:"1.0"}},resizeBy:function(j,k){var l=d.get(this.editor.id+"_ifr");this.resizeTo(l.clientWidth+j,l.clientHeight+k)},resizeTo:function(j,m){var k=this.editor,l=k.settings,o=d.get(k.id+"_tbl"),p=d.get(k.id+"_ifr"),n;j=Math.max(l.theme_xenforo_resizing_min_width||100,j);m=Math.max(l.theme_xenforo_resizing_min_height||100,m);j=Math.min(l.theme_xenforo_resizing_max_width||65535,j);m=Math.min(l.theme_xenforo_resizing_max_height||65535,m);n=o.clientHeight-p.clientHeight;d.setStyle(p,"height",m-n);d.setStyles(o,{width:j,height:m})},destroy:function(){var j=this.editor.id;b.clear(j+"_resize");b.clear(j+"_path_row");b.clear(j+"_external_close")},_simpleLayout:function(z,u,l,j){var y=this,v=y.editor,w=z.theme_xenforo_toolbar_location,q=z.theme_xenforo_statusbar_location,m,k,r,x;if(z.readonly){m=d.add(u,"tr");m=k=d.add(m,"td",{"class":"mceIframeContainer"});return k}if(w=="top"){y._addToolbars(u,l)}if(w=="external"){m=x=d.create("div",{style:"position:relative"});m=d.add(m,"div",{id:v.id+"_external","class":"mceExternalToolbar"});d.add(m,"a",{id:v.id+"_external_close",href:"javascript:;","class":"mceExternalClose"});m=d.add(m,"table",{id:v.id+"_tblext",cellSpacing:0,cellPadding:0});r=d.add(m,"tbody");if(j.firstChild.className=="mceOldBoxModel"){j.firstChild.appendChild(x)}else{j.insertBefore(x,j.firstChild)}y._addToolbars(r,l);v.onMouseUp.add(function(){var o=d.get(v.id+"_external");d.show(o);d.hide(h);var n=b.add(v.id+"_external_close","click",function(){d.hide(v.id+"_external");b.remove(v.id+"_external_close","click",n)});d.show(o);d.setStyle(o,"top",0-d.getRect(v.id+"_tblext").h-1);d.hide(o);d.show(o);o.style.filter="";h=v.id+"_external";o=null})}if(q=="top"){y._addStatusBar(u,l)}if(!z.theme_xenforo_toolbar_container){m=d.add(u,"tr");m=k=d.add(m,"td",{"class":"mceIframeContainer"})}if(w=="bottom"){y._addToolbars(u,l)}if(q=="bottom"){y._addStatusBar(u,l)}return k},_rowLayout:function(x,p,l){var w=this,q=w.editor,v,y,j=q.controlManager,m,k,u,r;v=x.theme_xenforo_containers_default_class||"";y=x.theme_xenforo_containers_default_align||"center";g(c(x.theme_xenforo_containers||""),function(s,o){var n=x["theme_xenforo_container_"+s]||"";switch(n.toLowerCase()){case"mceeditor":m=d.add(p,"tr");m=k=d.add(m,"td",{"class":"mceIframeContainer"});break;case"mceelementpath":w._addStatusBar(p,l);break;default:r=(x["theme_xenforo_container_"+s+"_align"]||y).toLowerCase();r="mce"+w._ufirst(r);m=d.add(d.add(p,"tr"),"td",{"class":"mceToolbar "+(x["theme_xenforo_container_"+s+"_class"]||v)+" "+r||y});u=j.createToolbar("toolbar"+o);w._addControls(n,u);d.setHTML(m,u.renderHTML());l.deltaHeight-=x.theme_xenforo_row_height}});return k},_addControls:function(k,j){var l=this,m=l.settings,n,o=l.editor.controlManager;if(m.theme_xenforo_disable&&!l._disabled){n={};g(c(m.theme_xenforo_disable),function(p){n[p]=1});l._disabled=n}else{n=l._disabled}g(c(k),function(q){var p;if(n&&n[q]){return}if(q=="tablecontrols"){g(["table","|","row_props","cell_props","|","row_before","row_after","delete_row","|","col_before","col_after","delete_col","|","split_cells","merge_cells"],function(r){r=l.createControl(r,o);if(r){j.add(r)}});return}else{if(q.indexOf("xenforo_")==0&&l.editor.plugins[q]&&l.editor.plugins[q].addButtons){l.editor.plugins[q].addButtons(l,j);return}}p=l.createControl(q,o);if(p){j.add(p)}})},_addToolbars:function(x,k){var A=this,p,m,r=A.editor,B=A.settings,z,j=r.controlManager,u,l,q=[],y,w;w=j.createToolbarGroup("toolbargroup",{name:r.getLang("advanced.toolbar"),tab_focus_toolbar:r.getParam("theme_advanced_tab_focus_toolbar")});A.toolbarGroup=w;y=B.theme_xenforo_toolbar_align.toLowerCase();y="mce"+A._ufirst(y);l=d.add(d.add(x,"tr",{role:"presentation"}),"td",{"class":"mceToolbar "+y,role:"presentation"});for(p=1;(z=B["theme_xenforo_buttons"+p]);p++){m=j.createToolbar("toolbar"+p,{"class":"mceToolbarRow"+p});if(B["theme_xenforo_buttons"+p+"_add"]){z+=","+B["theme_xenforo_buttons"+p+"_add"]}if(B["theme_xenforo_buttons"+p+"_add_before"]){z=B["theme_xenforo_buttons"+p+"_add_before"]+","+z}A._addControls(z,m);w.add(m);k.deltaHeight-=B.theme_xenforo_row_height}q.push(w.renderHTML());q.push(d.createHTML("a",{href:"#",accesskey:"z",title:"",onfocus:"tinyMCE.getInstanceById('"+r.id+"').focus();"},"<!-- IE -->"));d.setHTML(l,q.join(""));$(l).find("a[id$=removeformat]").focus(function(){tinyMCE.getInstanceById(r.id).focus()})},_addStatusBar:function(p,k){var l,w=this,q=w.editor,x=w.settings,j,u,v,m;l=d.add(p,"tr");l=m=d.add(l,"td",{"class":"mceStatusbar"});l=d.add(l,"div",{id:q.id+"_path_row",role:"group","aria-labelledby":q.id+"_path_voice"});if(x.theme_advanced_path){d.add(l,"span",{id:q.id+"_path_voice"},q.translate("advanced.path"));d.add(l,"span",{},": ")}else{d.add(l,"span",{},"&#160;")}if(x.theme_xenforo_resizing){d.add(m,"a",{id:q.id+"_resize",href:"javascript:;",onclick:"return false;","class":"mceResize"});if(x.theme_xenforo_resizing_use_cookie){q.onPostRender.add(function(){var n=a.getHash("TinyMCE_"+q.id+"_size"),r=d.get(q.id+"_tbl");if(!n){return}if(x.theme_xenforo_resize_horizontal){r.style.width=Math.max(10,n.cw)+"px"}r.style.height=Math.max(10,n.ch)+"px";d.get(q.id+"_ifr").style.height=Math.max(10,parseInt(n.ch)+w.deltaHeight)+"px"})}q.onPostRender.add(function(){b.add(q.id+"_resize","mousedown",function(y){var A,t,o,s,z,r;A=d.get(q.id+"_tbl");o=A.clientWidth;s=A.clientHeight;miw=x.theme_xenforo_resizing_min_width||100;mih=x.theme_xenforo_resizing_min_height||100;maw=x.theme_xenforo_resizing_max_width||65535;mah=x.theme_xenforo_resizing_max_height||65535;t=d.add(d.get(q.id+"_parent"),"div",{"class":"mcePlaceHolder"});d.setStyles(t,{width:o,height:s});d.hide(A);d.show(t);j={x:y.screenX,y:y.screenY,w:o,h:s,dx:null,dy:null};u=b.add(d.doc,"mousemove",function(C){var n,B;j.dx=C.screenX-j.x;j.dy=C.screenY-j.y;n=Math.max(miw,j.w+j.dx);B=Math.max(mih,j.h+j.dy);n=Math.min(maw,n);B=Math.min(mah,B);if(x.theme_xenforo_resize_horizontal){t.style.width=n+"px"}t.style.height=B+"px";return b.cancel(C)});v=b.add(d.doc,"mouseup",function(n){var B;b.remove(d.doc,"mousemove",u);b.remove(d.doc,"mouseup",v);A.style.display="";d.remove(t);if(j.dx===null){return}B=d.get(q.id+"_ifr");if(x.theme_xenforo_resize_horizontal){A.style.width=Math.max(10,j.w+j.dx)+"px"}A.style.height=Math.max(10,j.h+j.dy)+"px";B.style.height=Math.max(10,B.clientHeight+j.dy)+"px";if(x.theme_xenforo_resizing_use_cookie){a.setHash("TinyMCE_"+q.id+"_size",{cw:j.w+j.dx,ch:j.h+j.dy})}});return b.cancel(y)})})}k.deltaHeight-=21;l=p=null},_updateUndoStatus:function(k){var j=k.controlManager;j.setDisabled("undo",!k.undoManager.hasUndo()&&!k.typing);j.setDisabled("redo",!k.undoManager.hasRedo())},_nodeChanged:function(m,w,l,r){var z=this,j,u=0,y,o,A=z.settings,x,k,q;if(A.readonly){return}f.each(z.stateControls,function(n){w.setActive(n,m.queryCommandState(z.controls[n][1]))});w.setActive("visualaid",m.hasVisual);w.setDisabled("undo",!m.undoManager.hasUndo()&&!m.typing);w.setDisabled("redo",!m.undoManager.hasRedo());w.setDisabled("outdent",!m.queryCommandState("Outdent"));j=d.getParent(l,"A");if(o=w.get("link")){if(!j||!j.name){o.setDisabled(!j&&r);o.setActive(!!j)}}if(o=w.get("unlink")){o.setDisabled(!j&&r);o.setActive(!!j&&!j.name)}if(o=w.get("anchor")){o.setActive(!r&&!!j&&j.name);if(f.isWebKit){j=d.getParent(l,"IMG");o.setActive(!!j&&d.getAttrib(j,"mce_name")=="a")}}j=d.getParent(l,"IMG");if(o=w.get("image")){o.setActive(!r&&!!j&&l.className.indexOf("mceItem")==-1)}if(o=w.get("styleselect")){if(l.className){z._importClasses();o.select(l.className)}else{o.select()}}if(o=w.get("formatselect")){j=d.getParent(l,d.isBlock);if(j){o.select(j.nodeName.toLowerCase())}}if(m.settings.convert_fonts_to_spans){m.dom.getParent(l,function(p){if(p.nodeName==="SPAN"){if(!x&&p.className){x=p.className}if(!k&&p.style.fontSize){k=p.style.fontSize}if(!q&&p.style.fontFamily){q=p.style.fontFamily.replace(/[\"\']+/g,"").replace(/^([^,]+).*/,"$1").toLowerCase()}}return false});if(o=w.get("fontselect")){o.select(function(n){return n.replace(/^([^,]+).*/,"$1").toLowerCase()==q})}if(o=w.get("fontsizeselect")){o.select(function(n){if(n.fontSize&&n.fontSize===k){return true}if(n["class"]&&n["class"]===x){return true}})}}else{if(o=w.get("fontselect")){o.select(m.queryCommandValue("FontName"))}if(o=w.get("fontsizeselect")){y=m.queryCommandValue("FontSize");o.select(function(n){return n.fontSize==y})}}if(A.theme_xenforo_path&&A.theme_xenforo_statusbar_location){j=d.get(m.id+"_path")||d.add(m.id+"_path_row","span",{id:m.id+"_path"});d.setHTML(j,"");m.dom.getParent(l,function(B){var p=B.nodeName.toLowerCase(),s,v,t="";if(B.nodeType!=1||B.nodeName==="BR"||(d.hasClass(B,"mceItemHidden")||d.hasClass(B,"mceItemRemoved"))){return}if(y=d.getAttrib(B,"mce_name")){p=y}if(f.isIE&&B.scopeName!=="HTML"){p=B.scopeName+":"+p}p=p.replace(/mce\:/g,"");switch(p){case"b":p="strong";break;case"i":p="em";break;case"img":if(y=d.getAttrib(B,"src")){t+="src: "+y+" "}break;case"a":if(y=d.getAttrib(B,"name")){t+="name: "+y+" ";p+="#"+y}if(y=d.getAttrib(B,"href")){t+="href: "+y+" "}break;case"font":if(A.convert_fonts_to_spans){p="span"}if(y=d.getAttrib(B,"face")){t+="font: "+y+" "}if(y=d.getAttrib(B,"size")){t+="size: "+y+" "}if(y=d.getAttrib(B,"color")){t+="color: "+y+" "}break;case"span":if(y=d.getAttrib(B,"style")){t+="style: "+y+" "}break}if(y=d.getAttrib(B,"id")){t+="id: "+y+" "}if(y=B.className){y=y.replace(/(webkit-[\w\-]+|Apple-[\w\-]+|mceItem\w+|mceVisualAid)/g,"");if(y&&y.indexOf("mceItem")==-1){t+="class: "+y+" ";if(d.isBlock(B)||p=="img"||p=="span"){p+="."+y}}}p=p.replace(/(html:)/g,"");p={name:p,node:B,title:t};z.onResolveName.dispatch(z,p);t=p.title;p=p.name;v=d.create("a",{href:"javascript:;",onmousedown:"return false;",title:t,"class":"mcePath_"+(u++)},p);if(j.hasChildNodes()){j.insertBefore(d.doc.createTextNode(" \u00bb "),j.firstChild);j.insertBefore(v,j.firstChild)}else{j.appendChild(v)}},m.getBody())}},_sel:function(j){this.editor.execCommand("mceSelectNodeDepth",false,j)},_mceHelp:function(){var j=this.editor;j.windowManager.open({url:this._getFullDialogUrl("about"),width:480,height:380,inline:true},{theme_url:this.url})},_mceColorPicker:function(l,k){var j=this.editor;k=k||{};j.windowManager.open({url:this._getFullDialogUrl("color_picker"),width:375+parseInt(j.getLang("xenforo.colorpicker_delta_width",0)),height:250+parseInt(j.getLang("xenforo.colorpicker_delta_height",0)),close_previous:false,inline:true,translate_i18n:false},{input_color:k.color,func:k.func,theme_url:this.url})},_mceImage:function(k,l){var j=this.editor;if(j.dom.getAttrib(j.selection.getNode(),"class").indexOf("mceItem")!=-1){return}if(j.getParam("fast_overlay")==1){XenForo.tinymce._overlay_callbacks(this,"_mceImage_ontrigger","_mceImage_onload");XenForo.ajax("index.php?editor/fast-dialog",{dialog:"fast_image"},XenForo.tinymce._overlay_success)}else{j.windowManager.open({url:this._getFullDialogUrl("image"),width:355+parseInt(j.getLang("xenforo.image_delta_width",0)),height:275+parseInt(j.getLang("xenforo.image_delta_height",0)),inline:true,translate_i18n:false},{theme_url:this.url})}},_mceImage_onload:function(l,j){var k=this.editor,m=k.dom.getAttrib(l.getNode(),"src");if(m.length>0){j.find("#ctrl_src").val(m)}},_mceImage_ontrigger:function(j){var m=this,k=this.editor,l={},n;if(j.src===""){if(k.selection.getNode().nodeName=="IMG"){k.dom.remove(k.selection.getNode());k.execCommand("mceRepaint")}return}f.extend(l,{src:j.src,"class":"bbCodeImage"});n=k.selection.getNode();if(n&&n.nodeName=="IMG"){k.dom.setAttribs(n,l)}else{k.execCommand("mceInsertContent",false,'<img id="__mce_tmp" />',{skip_undo:1});k.dom.setAttribs("__mce_tmp",l);k.dom.setAttrib("__mce_tmp","id","");k.undoManager.add()}return},_mceLink:function(k,l){var j=this.editor;if(j.getParam("fast_overlay")==1){XenForo.tinymce._overlay_callbacks(this,"_mceLink_ontrigger","_mceLink_onload");XenForo.ajax("index.php?editor/fast-dialog",{dialog:"fast_link"},XenForo.tinymce._overlay_success)}else{j.windowManager.open({url:this._getFullDialogUrl("link"),width:310+parseInt(j.getLang("xenforo.link_delta_width",0)),height:200+parseInt(j.getLang("xenforo.link_delta_height",0)),inline:true,translate_i18n:false},{theme_url:this.url})}},_mceLink_onload:function(l,j){var k=this.editor;if(e=k.dom.getParent(k.selection.getNode(),"A")){j.find("#ctrl_url").val(k.dom.getAttrib(e,"href"))}},_mceLink_ontrigger:function(k){var m=this.editor,n,j,l=this._mceLink_checkPrefix(k.href).replace(/ /g,"%20");m.selection.moveToBookmark(XenForo.tinymce.bm);n=m.dom.getParent(m.selection.getNode(),"A");if(!l){if(n){j=m.selection.getBookmark();m.dom.remove(n,1);m.selection.moveToBookmark(j);m.execCommand("mceEndUndoLevel")}}if(n==null){m.getDoc().execCommand("unlink",false,null);m.execCommand("mceInsertLink",false,"#mce_temp_url#",{skip_undo:1});f.each(m.dom.select("a"),function(o){if(m.dom.getAttrib(o,"href")=="#mce_temp_url#"){n=o;m.dom.setAttribs(n,{href:l})}})}else{m.dom.setAttribs(n,{href:l})}if(n&&(n.childNodes.length!=1||n.firstChild.nodeName!="IMG")){m.focus();m.selection.select(n);m.selection.collapse(0)}m.execCommand("mceEndUndoLevel")},_mceLink_checkPrefix:function(k){k=$.trim(k);var j=k.replace(/\?.*$/,"");if(k&&Validator.isEmail(j)&&!/^\s*mailto:/i.test(k)){k="mailto:"+k}else{if(!/^((https?|ftp):\/\/|mailto:)/i.test(k)){k="http://"+k}}return k},_mceForeColor:function(){var j=this;this._mceColorPicker(0,{color:j.fgColor,func:function(k){j.fgColor=k;j.editor.execCommand("ForeColor",false,k)}})},_mceBackColor:function(){var j=this;this._mceColorPicker(0,{color:j.bgColor,func:function(k){j.bgColor=k;j.editor.execCommand("HiliteColor",false,k)}})},_ufirst:function(j){return j.substring(0,1).toUpperCase()+j.substring(1)},_getFullDialogUrl:function(j){var k=this.settings.theme_xenforo_dialog_url;if(k.indexOf("?")==-1){return k+"?dialog="+encodeURIComponent(j)}else{return k+"&dialog="+encodeURIComponent(j)}},_RemoveFormat:function(){if(this._removeFormatExecuting){return}this._removeFormatExecuting=true;var j=this.editor;j.execCommand("removeFormat",false);j.formatter.remove("xenForoRemoveFormat");this._removeFormatExecuting=false},_removeFormatExecuting:false,_Indent:function(j,k){return this._handleIndentOutdent("indent")},_Outdent:function(j){return this._handleIndentOutdent("outdent")},_handleIndentOutdent:function(p){var l,k,n,q=(XenForo.isRTL()?"paddingRight":"paddingLeft"),j=this.editor,m=j.selection,o=j.dom;l=j.settings.indentation;k=/[a-z%]+$/i.exec(l);l=parseInt(l);if(!j.queryCommandState("InsertUnorderedList")&&!j.queryCommandState("InsertOrderedList")){g(m.getSelectedBlocks(),function(r){if(p=="outdent"){n=Math.max(0,parseInt(r.style[q]||0)-l);o.setStyle(r,q,n?n+k:"")}else{o.setStyle(r,q,(parseInt(r.style[q]||0)+l)+k)}})}else{j.getDoc().execCommand(p,false,null)}},_queryOutdent:function(){var m,o=(XenForo.isRTL()?"paddingRight":"paddingLeft"),j=this.editor,l=j.settings,k=j.selection,n=j.dom;if(l.inline_styles){if((m=n.getParent(k.getStart(),n.isBlock))&&parseInt(m.style[o])>0){return true}if((m=n.getParent(k.getEnd(),n.isBlock))&&parseInt(m.style[o])>0){return true}}return j.queryCommandState("InsertUnorderedList")||j.queryCommandState("InsertOrderedList")||(!l.inline_styles&&!!n.getParent(k.getNode(),"BLOCKQUOTE"))}});f.ThemeManager.add("xenforo",f.themes.XenForoTheme)}(tinymce));